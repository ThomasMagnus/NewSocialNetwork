document.addEventListener("DOMContentLoaded",(()=>{"use strict";const e=document.querySelector(".userCover"),t=document.querySelector(".userCover__edit_wrapper"),o=document.querySelectorAll(".fa-ellipsis-v"),n=document.querySelectorAll(".ellipsis__list"),c=document.querySelectorAll(".edit-post"),r=document.querySelectorAll(".cancel__wrapper"),s=document.querySelector(".content__btn"),l=document.querySelector(".content__form"),i=document.querySelectorAll(".content__edit-btn"),a=document.querySelectorAll(".ellipsis__del"),d=document.querySelector(".userCover__edit"),u=document.querySelector(".errorlist"),_=document.querySelector(".cover__form"),m=document.querySelector(".search__input"),h=document.querySelector(".search");let p,y,v,S;const f=async(e,t,o)=>await fetch(t,{method:"POST",body:e,headers:o,credentials:"include"}),g=e=>{p=e.target,y=p.closest(".content__item"),v=y.querySelector(".content__text-edit"),S=y.querySelector(".content__panel")},L=e=>{let t=q();g(e);const o=p.parentElement.querySelector(".ellipsis__list");t&&n[t]===o?o.classList.remove("active_disp"):o.classList.add("active_disp")},q=()=>{let e;return n.forEach(((t,o)=>{t.classList.contains("active_disp")&&(t.classList.remove("active_disp"),e=o)})),e},E=e=>{g(e);const t=y.querySelector(".content__text"),o=document.createElement("form"),n=document.createElement("textarea"),c=y.querySelector(".content__text-edit"),r=y.querySelector(".content__panel");q(),o.classList.add("edit_post_form"),t.style.display="none",n.classList.add("edit__content"),n.setAttribute("data-id",t.getAttribute("data-id")),n.setAttribute("name","editPost"),o.append(n),n.value=t.textContent,c.before(o),r.style.display="flex"},k=e=>{g(e);const t=y.querySelector(".edit__content"),o=y.querySelector(".content__text");t.remove(),S.style.display="none",o.style.display="block"},b=()=>{let e=document.querySelector(".edit_post_form").querySelector(".edit__content");const t={editPost:e.value,id:e.getAttribute("data-id")},o=JSON.stringify(t);f(o,"http://localhost:8000/createPost/edit/",A()).then((e=>console.log(e))).finally((()=>{document.location.reload()}))},A=()=>{const e=new Headers;return e.append("X-CSRFToken",(e=>{let t=null;if(document.cookie&&""!==document.cookie){const o=document.cookie.split(";");for(let n=0;n<=o.length-1;n++)o[n].substring(0,e.length+1)===e+"="&&(t=decodeURIComponent(o[n].substring(e.length+1)))}return t})("csrftoken")),e};e.addEventListener("mouseenter",(()=>{t.classList.toggle("edit__active")})),e.addEventListener("mouseleave",(()=>{t.classList.remove("edit__active")})),o.forEach((e=>e.addEventListener("click",L))),c.forEach((e=>e.addEventListener("click",E))),r.forEach((e=>e.addEventListener("click",k))),i.forEach((e=>e.addEventListener("click",b))),s.addEventListener("click",(e=>(e=>{e.preventDefault();const t=new FormData(l);""!==document.querySelector("#comment").value&&f(t,"http://localhost:8000/createPost/",A()).then((e=>console.log(e))).finally((()=>{l.reset(),document.location.reload()}))})(e))),a.forEach((e=>e.addEventListener("click",(e=>(e=>{const t=e.target,o=t.closest(".content__item").querySelector(".content__text");t.closest(".ellipsis__list ").classList.remove("active_disp");const n={postId:o.getAttribute("data-id")},c=JSON.stringify(n);f(c,"http://localhost:8000/createPost/deletePost/",A()).then((e=>console.log(e))).finally((()=>document.location.reload()))})(e))))),d.addEventListener("change",(()=>{const e=new FormData(_),t={"X-CSRFToken":A()},o=document.location.pathname.match(/\d/g).join("");e.append("user_id",o),f(e,"http://localhost:8000/users/changeCover/photo",t).then((e=>{console.log(e),document.location.reload()}))})),m.addEventListener("input",(()=>{class e{constructor(e,t,o,n=7){this.name=e,this.id=t,this.avatar=o,this.limit=n}createUSer(e){const t=e=>`\n                            <a href=http://localhost:8000/friends/${this.id}>\n                                <div class="search__img">\n                                    <img src="${e}" alt="friend_img">\n                                </div>\n                                ${this.name}\n                            </a>\n                        `,o=this.avatar?t(this.avatar):t("/static/img/user_logo.jpg"),n=document.createElement("li");n.classList.add("search__friendItem"),n.innerHTML=o,e.append(n)}}const t=()=>{try{h.querySelector(".search__friendList").remove()}catch(e){}};if(m.value.trim()){let o={friendsSearch:m.value.toLowerCase()},n=JSON.stringify(o);f(n,"http://localhost:8000/users/friends/searchFriend/",A()).then((e=>e.json())).then((o=>{t();const n=document.createElement("ul");n.classList.add("search__friendList"),h.append(n),o.forEach((t=>{let c;console.log(t),c=o.length>7?new e(t[0],t[1],t[2]):new e(t[0],t[1],t[2],o.length),c.createUSer(n),console.log(`User: ${t[0]}, id: ${t[1]}`)}))}))}else t()})),document.body.addEventListener("click",(e=>(e=>{const t=e.target;try{".search__friendItem a"!==t.classList&&document.querySelector(".search__friendList").remove()}catch{}})(e))),u.style.display="none"}));